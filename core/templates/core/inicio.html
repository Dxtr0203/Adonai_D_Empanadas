{% extends "base.html" %}
{% load static %}

{% block title %}Inicio | Adonai{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row align-items-center g-4">
    <div class="col-lg-6">
      <h1 class="display-6 fw-bold mb-3">Bienvenido a Adonai Pet Shop</h1>
      <p class="lead text-secondary">
        En Adonai, te ofrecemos lo mejor para tu mejor amigo: alimentos, juguetes, higiene, y m√°s. Disfruta de nuestro servicio de delivery en La Paz.
      </p>
      <div class="d-flex gap-2 mt-4">
        <a href="{% url 'catalogo' %}" class="btn btn-primary btn-lg">
          <i class="bi bi-bag-heart me-2"></i> Ver cat√°logo
        </a>
         <a href="{% url 'usuarios:register' %}" class="btn btn-outline-primary btn-lg">
           <i class="bi bi-person-plus me-2"></i> Registrarse
         </a>
        <a href="https://api.whatsapp.com/send?phone=59171972238&fbclid=IwdGRjcANswOBjbGNrA2zA1mV4dG4DYWVtAjExAAEeKW50x--5yqoet8rEdMWWA-x9_5OlKSOEh30898P-6hmNGYtUN49vIaR3zp8_aem_GDNLaemVvxCcbNUOCS_e5g" class="btn btn-outline-success btn-lg">
          <i class="bi bi-whatsapp me-2"></i> Cont√°ctanos por WhatsApp
        </a>
      </div>
      <div class="text-secondary small mt-3">
        <i class="bi bi-truck me-1"></i> Delivery el mismo d√≠a
        ¬∑ <i class="bi bi-shield-check me-1"></i> Pago seguro
        ¬∑ <i class="bi bi-geo-alt me-1"></i> La Paz - Bolivia
      </div>
    </div>

    <!-- Carrusel de im√°genes -->
    <div class="col-lg-6">
      <div id="hero-carousel" class="position-relative rounded-4 overflow-hidden shadow">
        <img src="{% static 'img/imagen1.jpg' %}" class="w-100 hero-img active" alt="Mascota feliz">
        <img src="{% static 'img/imagen2.jpg' %}" class="w-100 hero-img" alt="Comida para mascotas">
        <img src="{% static 'img/imagen3.jpg' %}" class="w-100 hero-img" alt="Juguetes para perros">
        <img src="{% static 'img/imagen4.jpg' %}" class="w-100 hero-img" alt="Juguetes para perros">
        <img src="{% static 'img/imagen6.jpg' %}" class="w-100 hero-img" alt="Juguetes para perros">
      </div>
    </div>
  </div>
</div>

<!-- Secci√≥n Misi√≥n y Visi√≥n -->
<div class="container py-5">
  <div class="row">
    <!-- Misi√≥n -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm h-100 border-0">
        <div class="card-body">
          <h3 class="card-title text-center text-primary">Nuestra Misi√≥n</h3>
          <p class="lead text-muted text-center">
            Brindar productos y servicios de alta calidad para el cuidado y bienestar de las mascotas, proporcionando un ambiente donde los due√±os de mascotas puedan encontrar todo lo necesario para sus fieles compa√±eros.
          </p>
        </div>
      </div>
    </div>

    <!-- Visi√≥n -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow-sm h-100 border-0">
        <div class="card-body">
          <h3 class="card-title text-center text-primary">Nuestra Visi√≥n</h3>
          <p class="lead text-muted text-center">
            Convertirnos en la tienda l√≠der en Bolivia en productos y servicios para mascotas, ofreciendo un excelente servicio al cliente y una experiencia de compra √∫nica para cada due√±o de mascota.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Servicios Destacados -->
<div class="container py-5">
  <h2 class="display-6 fw-bold text-center mb-4">Nuestros Servicios</h2>
  <div class="row row-cols-1 row-cols-md-3 g-4">
    <div class="col">
      <div class="card shadow-sm h-100 border-0 service-card">
        <div class="service-img-container">
          <img src="{% static 'img/alimentos.jpg' %}" class="card-img-top" alt="Alimentos para Mascotas">
        </div>
        <div class="card-body">
          <h5 class="card-title text-primary fw-semibold">Alimentos para Mascotas</h5>
          <p class="card-text">Encuentra los mejores alimentos para perros, gatos y otras mascotas. Marcas de confianza con los nutrientes necesarios para su salud.</p>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card shadow-sm h-100 border-0 service-card">
        <div class="service-img-container">
          <img src="{% static 'img/juguetes.jpg' %}" class="card-img-top" alt="Juguetes para Mascotas">
        </div>
        <div class="card-body">
          <h5 class="card-title text-primary fw-semibold">Juguetes para Mascotas</h5>
          <p class="card-text">Juguetes divertidos y seguros para el entretenimiento de tu mascota. Estimula su mente y mant√©nlos activos.</p>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="card shadow-sm h-100 border-0 service-card">
        <div class="service-img-container">
          <img src="{% static 'img/higiene.jpg' %}" class="card-img-top" alt="Higiene para Mascotas">
        </div>
        <div class="card-body">
          <h5 class="card-title text-primary fw-semibold">Productos de Higiene</h5>
          <p class="card-text">Ofrecemos productos para el cuidado y limpieza de tu mascota, desde champ√∫s hasta accesorios para ba√±o y salud.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Secci√≥n Historial de Compras -->
{% if user.is_authenticated %}
<div class="container py-5">
  <h2 class="h4 mb-4"><i class="bi bi-clock-history"></i> Historial de Compras</h2>
  
  {% if historial_compras %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th scope="col">N¬∞#</th>
            <th scope="col">Cantidad Total</th>
            <th scope="col">Monto (Bs.)</th>
            <th scope="col">M√©todo de Pago</th>
            <th scope="col">Fecha y Hora</th>
            <th scope="col">Acci√≥n</th>
          </tr>
        </thead>
        <tbody>
          {% for compra in historial_compras %}
          <tr>
            <td>
              <strong>COMPRA #{{ compra.numero_compra }}</strong>
            </td>
            <td class="text-center">
              <span class="badge bg-secondary">{{ compra.cantidad_total }} item{{ compra.cantidad_total|pluralize }}</span>
            </td>
            <td>
              <strong>Bs. {{ compra.monto_total|floatformat:2 }}</strong>
            </td>
            <td>
              <span class="badge bg-info text-dark">{{ compra.metodo_pago|upper }}</span>
            </td>
            <td>
              {{ compra.creado_en|date:"d/m/Y H:i" }}
            </td>
            <td>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalDetalle{{ compra.venta_id }}">
                <i class="bi bi-eye"></i> DETALLE
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="alert alert-info mt-3">
      <small><strong>Total de compras registradas:</strong> {{ historial_compras|length }}</small>
    </div>
  {% else %}
    <div class="alert alert-warning" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      <strong>Sin compras a√∫n.</strong> Cuando realices tu primera compra, aparecer√° aqu√≠ tu historial de compras.
    </div>
  {% endif %}
</div>

<!-- Modales de Detalle para cada compra -->
{% for compra in historial_compras %}
<div class="modal fade" id="modalDetalle{{ compra.venta_id }}" tabindex="-1" aria-labelledby="modalDetalle{{ compra.venta_id }}Label" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalDetalle{{ compra.venta_id }}Label">
          <i class="bi bi-bag"></i> Detalles de COMPRA #{{ compra.numero_compra }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <p><strong>Fecha:</strong> {{ compra.creado_en|date:"d/m/Y H:i" }}</p>
            <p><strong>M√©todo de Pago:</strong> <span class="badge bg-info text-dark">{{ compra.metodo_pago|upper }}</span></p>
          </div>
          <div class="col-md-6">
            <p><strong>Estado:</strong> 
              {% if compra.estado == 'pagado' %}
                <span class="badge bg-success">Pagado</span>
              {% else %}
                <span class="badge bg-warning">{{ compra.estado|title }}</span>
              {% endif %}
            </p>
            <p><strong>Total:</strong> <span class="text-success fs-5">Bs. {{ compra.monto_total|floatformat:2 }}</span></p>
          </div>
        </div>

        <hr>

        <h6 class="mb-3"><i class="bi bi-cart-check"></i> Productos Comprados:</h6>
        
        {% if compra.detalles %}
          <div class="table-responsive">
            <table class="table table-sm table-bordered">
              <thead class="table-light">
                <tr>
                  <th>Producto</th>
                  <th class="text-center" style="width: 80px;">Cantidad</th>
                  <th class="text-end" style="width: 100px;">Precio Unit.</th>
                  <th class="text-end" style="width: 100px;">Subtotal</th>
                </tr>
              </thead>
              <tbody>
                {% for detalle in compra.detalles %}
                <tr>
                  <td>{{ detalle.producto }}</td>
                  <td class="text-center">{{ detalle.cantidad }}</td>
                  <td class="text-end">Bs. {{ detalle.precio_unitario|floatformat:2 }}</td>
                  <td class="text-end"><strong>Bs. {{ detalle.subtotal|floatformat:2 }}</strong></td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot>
                <tr class="table-info">
                  <th colspan="3" class="text-end">TOTAL:</th>
                  <th class="text-end"><strong>Bs. {{ compra.monto_total|floatformat:2 }}</strong></th>
                </tr>
              </tfoot>
            </table>
          </div>
        {% else %}
          <div class="alert alert-warning" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Detalles no disponibles.</strong> Los productos de esta compra a√∫n se est√°n procesando. Por favor, intenta m√°s tarde.
          </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% endif %}

<!-- üé® Estilos -->
<style>
  /* === Carrusel === */
  #hero-carousel {
    position: relative;
    height: 400px;
  }

  .hero-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity 1.5s ease;
  }

  .hero-img.active {
    opacity: 1;
  }

  /* === Tarjetas de servicio === */
  .service-img-container {
    overflow: hidden;
    height: 260px;
    border-radius: 0.5rem 0.5rem 0 0;
  }

  .service-img-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease, filter 0.5s ease;
  }

  .service-card:hover .service-img-container img {
    transform: scale(1.1);
    filter: brightness(0.85);
  }

  .service-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .service-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  }
</style>

<!-- üéûÔ∏è Carrusel Autom√°tico -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const images = document.querySelectorAll("#hero-carousel .hero-img");
    let index = 0;

    setInterval(() => {
      images[index].classList.remove("active");
      index = (index + 1) % images.length;
      images[index].classList.add("active");
    }, 4000);
  });
</script>
{% endblock %}
