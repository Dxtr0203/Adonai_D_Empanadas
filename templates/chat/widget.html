{% load static %}
<!-- Chat widget: se incluye en base.html y gestiona su propio JS -->
<div id="chat-widget" style="position:fixed;bottom:20px;left:20px;z-index:1050;">
  <div id="chat-toggle" class="btn btn-primary" style="border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,.12);">
    <i class="bi bi-chat-dots" style="font-size:1.3rem;color:white"></i>
  </div>

  <div id="chat-panel" class="card" style="width:320px;max-height:420px;display:none;overflow:hidden;margin-top:10px;">
    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>Chatbot</strong>
      <button id="chat-close" class="btn btn-sm btn-link">Cerrar</button>
    </div>
    <!-- Quick action buttons (Información rápida) -->
    <div id="chat-quick-actions" class="p-2" style="display:block;background:#ffffff;border-bottom:1px solid #eee;">
      <div class="d-flex gap-2 flex-wrap">
        <button class="btn btn-sm btn-outline-primary quick-action">Información tienda</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Catálogo</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Servicios</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Horarios</button>
      </div>
    </div>
    <div id="chat-messages" class="card-body" style="overflow:auto;height:300px;background:#f8f9fa"></div>
    <div id="chat-options" class="mt-0" style="display:flex;flex-wrap:wrap;gap:3px;margin-top:5px;"></div>
    <div class="card-footer">
      <div class="input-group">
        <input id="chat-input" type="text" class="form-control" placeholder="Escribe tu mensaje...">
        <button id="chat-send" class="btn btn-primary">Enviar</button>
      </div>
    </div>
  </div>
</div>

<!-- Ajuste del estilo para reducir el espacio entre el texto y los botones -->
<style>
  /* Ajustar el espaciado entre el texto y los botones */
  .chat-options {
    margin-top: 5px; /* Reducir el margen superior */
    display: flex;
    flex-wrap: wrap;
    gap: 5px; /* Reducir el espacio entre botones */
  }
</style>

<script src="{% static 'js/chat_widget.js' %}"></script>

<script>
  // Inline diagnostic marker: should appear once if the template is included and scripts run
  (function(){
    try{
      var m = document.getElementById('chat-messages');
      if(m && !window._adonai_chat_marker){
        var el = document.createElement('div');
        el.className = 'mb-2';
        el.innerHTML = '<div class="text-start"><div class="d-inline-block p-2 bg-warning text-dark rounded">[WIDGET OK] El template del chat se ha incluido (mensaje visible para diagnóstico).</div></div>';
        m.appendChild(el);
        m.scrollTop = m.scrollHeight;
        window._adonai_chat_marker = true;
      }
    }catch(e){ console.error('chat widget inline marker error', e); }
  })();
</script>
