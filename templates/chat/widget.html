{% load static %}

<!-- Chat widget mejorado -->
<div id="chat-widget" 
     style="position:fixed;bottom:20px;left:20px;z-index:2000;"> <!-- ✅ z-index aumentado -->
  
  <!-- Botón flotante -->
  <div id="chat-toggle" class="btn btn-primary" 
       data-user-id="{% if user.is_authenticated %}{{ user.id }}{% endif %}"
       data-authenticated="{% if user.is_authenticated %}1{% else %}0{% endif %}"
       style="border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;
              box-shadow:0 6px 18px rgba(0,0,0,.12);z-index:2001 !important;"> <!-- ✅ botones prioridad máxima -->
    <i class="bi bi-chat-dots" style="font-size:1.3rem;color:white"></i>
  </div>

  <!-- Panel de chat -->
  <div id="chat-panel" class="card" 
       style="width:320px;max-height:500px;height:auto;display:none;overflow:visible;margin-top:10px;flex-shrink:0;"> 
       <!-- ✅ overflow visible, altura ajustada, flex-shrink 0 -->

    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>Chatbot</strong>
      <button id="chat-close" class="btn btn-sm btn-link" style="z-index:2001 !important;">Cerrar</button>
    </div>

    <!-- Acciones rápidas -->
    <div id="chat-quick-actions" class="p-2" 
         style="display:block;background:#ffffff;border-bottom:1px solid #eee;z-index:2001 !important;">
      <div class="d-flex gap-2 flex-wrap">
        <button class="btn btn-sm btn-outline-primary quick-action">Información tienda</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Catálogo</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Servicios</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Horarios</button>
        <button class="btn btn-sm btn-outline-primary quick-action">Atención Personalizada</button>
      </div>
    </div>

    <!-- Mensajes -->
    <div id="chat-messages" class="card-body" 
         style="overflow:auto;max-height:500px;height:240px;background:#f8f9fa;flex-shrink:0;"></div>

    <!-- Input -->
    <div class="card-footer">
      <div class="input-group">
        <input id="chat-input" type="text" class="form-control" placeholder="Escribe tu mensaje...">
        <button id="chat-send" class="btn btn-primary" style="z-index:2001 !important;">Enviar</button>
      </div>
    </div>
  </div>
</div>

<!-- Estilos adicionales -->
<style>
  /* ✅ Ajustes globales del chat */
  #chat-widget, #chat-panel, #chat-toggle, #chat-quick-actions, #chat-send, #chat-close {
    position: relative;
  }

  /* ✅ Botones visibles y consistentes */
  #chat-quick-actions button {
    cursor: pointer;
    white-space: nowrap;
    z-index: 2001 !important;
  }

  /* ✅ Mejor separación */
  #chat-quick-actions .d-flex {
    gap: 5px;
  }

  /* ✅ Asegurar que el panel no colapse */
  #chat-panel * {
    flex-shrink: 0;
  }

  /* ✅ Transiciones suaves opcionales */
  #chat-panel {
    transition: all 0.25s ease-in-out;
  }
</style>

<script src="{% static 'js/chat_widget.js' %}"></script>
